<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>client/spa/WarningScore.js - Documentation</title>

    <script src="scripts/hljs/highlight.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/hljs.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AdmitPatient.html">AdmitPatient</a><ul class='methods'><li data-type='method'><a href="AdmitPatient.html#admit">admit</a></li><li data-type='method'><a href="AdmitPatient.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="AdmitPatient.html#getImg">getImg</a></li><li data-type='method'><a href="AdmitPatient.html#render">render</a></li><li data-type='method'><a href="AdmitPatient.html#setImg">setImg</a></li></ul></li><li><a href="App.html">App</a><ul class='methods'><li data-type='method'><a href="App.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="App.html#onChange">onChange</a></li><li data-type='method'><a href="App.html#render">render</a></li></ul></li><li><a href="global.html#Contact">Contact</a><ul class='methods'><li data-type='method'><a href="global.html#Contact#insert">insert</a></li><li data-type='method'><a href="global.html#Contact#populate">populate</a></li></ul></li><li><a href="CreateWard.html">CreateWard</a><ul class='methods'><li data-type='method'><a href="CreateWard.html#.validateForms">validateForms</a></li><li data-type='method'><a href="CreateWard.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="CreateWard.html#makeWard">makeWard</a></li><li data-type='method'><a href="CreateWard.html#render">render</a></li></ul></li><li><a href="DiagnosticReport.html">DiagnosticReport</a><ul class='methods'><li data-type='method'><a href="DiagnosticReport.html#fhir">fhir</a></li><li data-type='method'><a href="DiagnosticReport.html#fhirLinked">fhirLinked</a></li></ul></li><li><a href="Encounter.html">Encounter</a><ul class='methods'><li data-type='method'><a href="Encounter.html#delete">delete</a></li><li data-type='method'><a href="Encounter.html#fhir">fhir</a></li><li data-type='method'><a href="Encounter.html#insert">insert</a></li><li data-type='method'><a href="Encounter.html#populate">populate</a></li><li data-type='method'><a href="Encounter.html#update">update</a></li></ul></li><li><a href="Location.html">Location</a><ul class='methods'><li data-type='method'><a href="Location.html#.lookup">lookup</a></li><li data-type='method'><a href="Location.html#fhir">fhir</a></li><li data-type='method'><a href="Location.html#populate">populate</a></li></ul></li><li><a href="module.exports.html">exports</a></li><li><a href="NEWSError.html">NEWSError</a></li><li><a href="Observation.html">Observation</a><ul class='methods'><li data-type='method'><a href="Observation.html#fhir">fhir</a></li></ul></li><li><a href="OperationOutcome.html">OperationOutcome</a><ul class='methods'><li data-type='method'><a href="OperationOutcome.html#makeResponse">makeResponse</a></li></ul></li><li><a href="Patient.html">Patient</a><ul class='methods'><li data-type='method'><a href="Patient.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="Patient.html#delete">delete</a></li><li data-type='method'><a href="Patient.html#delete">delete</a></li><li data-type='method'><a href="Patient.html#fhir">fhir</a></li><li data-type='method'><a href="Patient.html#insert">insert</a></li><li data-type='method'><a href="Patient.html#populate">populate</a></li><li data-type='method'><a href="Patient.html#popupAE">popupAE</a></li><li data-type='method'><a href="Patient.html#popupHistory">popupHistory</a></li><li data-type='method'><a href="Patient.html#popupWarningScoreHistory">popupWarningScoreHistory</a></li><li data-type='method'><a href="Patient.html#render">render</a></li><li data-type='method'><a href="Patient.html#submitVitals">submitVitals</a></li><li data-type='method'><a href="Patient.html#update">update</a></li></ul></li><li><a href="Questionnaire.html">Questionnaire</a><ul class='methods'><li data-type='method'><a href="Questionnaire.html#toggleQuestionnaire">toggleQuestionnaire</a></li></ul></li><li><a href="Redirect.html">Redirect</a><ul class='methods'><li data-type='method'><a href="Redirect.html#componentWillMount">componentWillMount</a></li><li data-type='method'><a href="Redirect.html#render">render</a></li></ul></li><li><a href="SearchPatient.html">SearchPatient</a><ul class='methods'><li data-type='method'><a href="SearchPatient.html#componentWillUnmount">componentWillUnmount</a></li><li data-type='method'><a href="SearchPatient.html#render">render</a></li><li data-type='method'><a href="SearchPatient.html#renderPatients">renderPatients</a></li><li data-type='method'><a href="SearchPatient.html#search">search</a></li></ul></li><li><a href="Ward.html">Ward</a><ul class='methods'><li data-type='method'><a href="Ward.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="Ward.html#render">render</a></li><li data-type='method'><a href="Ward.html#renderPatients">renderPatients</a></li></ul></li><li><a href="WardList.html">WardList</a><ul class='methods'><li data-type='method'><a href="WardList.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="WardList.html#createWardList">createWardList</a></li><li data-type='method'><a href="WardList.html#render">render</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#AlcoholQuestionnaire">AlcoholQuestionnaire</a></li><li><a href="global.html#Breadcrumbs">Breadcrumbs</a></li><li><a href="global.html#calculate">calculate</a></li><li><a href="global.html#checkPass">checkPass</a></li><li><a href="global.html#createOutcome">createOutcome</a></li><li><a href="global.html#DecButton">DecButton</a></li><li><a href="global.html#decodeJWTPayload">decodeJWTPayload</a></li><li><a href="global.html#Diet">Diet</a></li><li><a href="global.html#dispatchMouseUp">dispatchMouseUp</a></li><li><a href="global.html#doModal">doModal</a></li><li><a href="global.html#DrugTable">DrugTable</a></li><li><a href="global.html#emulateTouch">emulateTouch</a></li><li><a href="global.html#Exercise">Exercise</a></li><li><a href="global.html#fhirBase">fhirBase</a></li><li><a href="global.html#formatDate">formatDate</a></li><li><a href="global.html#getCurrentUrl">getCurrentUrl</a></li><li><a href="global.html#getDate">getDate</a></li><li><a href="global.html#getGiven">getGiven</a></li><li><a href="global.html#getJwtPayload">getJwtPayload</a></li><li><a href="global.html#getPatientReport">getPatientReport</a></li><li><a href="global.html#getStyle">getStyle</a></li><li><a href="global.html#handleUser">handleUser</a></li><li><a href="global.html#HistoryReport">HistoryReport</a></li><li><a href="global.html#IncButton">IncButton</a></li><li><a href="global.html#Input">Input</a></li><li><a href="global.html#lengthPolicy">lengthPolicy</a></li><li><a href="global.html#Loader">Loader</a></li><li><a href="global.html#Modal">Modal</a></li><li><a href="global.html#noop">noop</a></li><li><a href="global.html#normalisePatientInfo">normalisePatientInfo</a></li><li><a href="global.html#normalisePatientReports">normalisePatientReports</a></li><li><a href="global.html#OtherQuestions">OtherQuestions</a></li><li><a href="global.html#PatientDemographicInfo">PatientDemographicInfo</a></li><li><a href="global.html#score">score</a></li><li><a href="global.html#scoreBP">scoreBP</a></li><li><a href="global.html#scoreCons">scoreCons</a></li><li><a href="global.html#scoreHeart">scoreHeart</a></li><li><a href="global.html#scoreOxy">scoreOxy</a></li><li><a href="global.html#scoreResp">scoreResp</a></li><li><a href="global.html#scoreSuppOxy">scoreSuppOxy</a></li><li><a href="global.html#scoreTemp">scoreTemp</a></li><li><a href="global.html#Select">Select</a></li><li><a href="global.html#showLogin">showLogin</a></li><li><a href="global.html#SignOff">SignOff</a></li><li><a href="global.html#toTitle">toTitle</a></li><li><a href="global.html#Welcome">Welcome</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">client/spa/WarningScore.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {doModal} from './util'

class NEWSError extends Error {
	/**
	 * Error wrapper for NEWS object
	 * @param {string} message Error message
	 * @param {string[]} missing missing vital signs
	 */
	constructor(message, missing) {
		super(message)
		this.name = 'NEWSError'
		this.missing = missing
	}
}

/**
 * ! TODO thorough testing
 */
export default class WarningScore {
	/**
	 * Warning score wrapper for patient info
	 * @param {object} report formatted diagnostic report
	 * @param {number} report.respiratory_rate
	 * @param {number} report.oxygen_saturation
	 * @param {number} report.heart_rate
	 * @param {number} report.body_temperature
	 * @param {number} report.systolic_bp
	 * @param {string} report.level_of_consciousness
	 * @param {string} report.supplemental_oxygen (on/off)
	 */
	constructor(report = {}) {
		// can't generate a proper EWS without these
		this.requiredFields = [
			'respiratory_rate',
			'oxygen_saturation',
			'heart_rate',
			'body_temperature',
			'systolic_bp',
			'level_of_consciousness',
		]
		this.respRate = report.respiratory_rate
		this.oxySat = report.oxygen_saturation
		this.heartRate = report.heart_rate
		this.bodyTemp = report.body_temperature
		this.systolicBP = report.systolic_bp
		this.conscLevel = report.level_of_consciousness
		this.suppOxygen = report.supplemental_oxygen
		this.missingFields = this.requiredFields.filter(field => !(field in report))
		if (this.missingFields.length === this.requiredFields.length) return
		if (this.missingFields.length) {
			doModal('Error with EWS Calculation', `Fields were missing during submission!&lt;/p>&lt;ul>&lt;li class="browser-default">${this.missingFields.join('&lt;/li>&lt;li>')}`)
		}
	}

	/**
	 * returns object with invididually scored elements (for use in chart)
	 * @return {object} each part of a patient warning score individually scored
	 */
	calculate() {
		if (this.missingFields.length) {
			return {score: 0}
		}
		return {
			resp: this.scoreResp(),
			oxySat: this.scoreOxy(),
			heartRate: this.scoreHeart(),
			bodyTemp: this.scoreTemp(),
			systolicBP: this.scoreBP(),
			conscLevel: this.scoreCons(),
			suppOxygen: this.scoreSuppOxy(),
		}
	}

	/**
	 * returns the NEWS for the given set of vital signs
	 * @returns {number} patient NEWS
	 */
	score() {
		const scores = this.calculate()
		console.table(scores)
		const vals = Object.values(scores)
		const highest = vals.sort().reverse()
		return highest[0]
	}

	/**
	 * Create an EWS for respiratory rate
	 * @returns {number}
	 */
	scoreResp() {
		const rate = parseFloat(this.respRate, 10)
		if (rate >= 12 &amp;&amp; rate &lt;= 20) return 0
		if (rate >= 9 &amp;&amp; rate &lt;= 11) return 1
		if (rate >= 21 &amp;&amp; rate &lt;= 24) return 2
		if (rate &lt;= 8 || rate >= 25) return 3
		throw new NEWSError(`Unable to calculate NEWS: respiratory rate incorrect (${rate})`)
	}

	/**
	 * Create EWS for patient oxygen saturation
	 * @returns {number}
	 */
	scoreOxy() {
		const sat = parseFloat(this.oxySat, 10)
		if (sat >= 96) return 0
		if (sat >= 94) return 1
		if (sat >= 92) return 2
		if (sat &lt;= 91) return 3
		throw new NEWSError(`Unable to calculate NEWS: oxygen saturation incorrect (${sat})`)
	}

	/**
	 * Create EWS for patient heart rate
	 * @returns {number}
	 */
	scoreHeart() {
		const rate = parseFloat(this.heartRate, 10)
		if (rate &lt;= 40 || rate >= 131) return 3
		if (rate >= 111 &amp;&amp; rate &lt;= 130) return 2
		if ((rate >= 41 &amp;&amp; rate &lt;= 50) || (rate >= 91 &amp;&amp; rate &lt;= 110)) return 1
		if (rate >= 51 &amp;&amp; rate &lt;= 90) return 0
		throw new NEWSError(`Unable to calculate NEWS: heart rate incorrect (${rate})`)
	}

	/**
	 * Create EWS for patient body temperature
	 * @returns {number}
	 */
	scoreTemp() {
		const temp = parseFloat(this.bodyTemp, 10)
		if (temp &lt;= 35) return 3
		if (temp >= 39.1) return 2
		if ((temp >= 35.1 &amp;&amp; temp &lt;= 36) || (temp >= 38.1 &amp;&amp; temp &lt;= 39)) return 1
		if (temp >= 36.1 &amp;&amp; temp &lt;= 38) return 0
		throw new NEWSError(`Unable to calculate NEWS: body temperature incorrect (${temp})`)
	}

	/**
	 * Create EWS for patient blood pressure
	 * @returns {number}
	 */
	scoreBP() {
		const bp = parseFloat(this.systolicBP, 10)
		if (bp &lt;= 90 || bp >= 220) return 3
		if (bp >= 91 &amp;&amp; bp &lt;= 100) return 2
		if (bp >= 101 &amp;&amp; bp &lt;= 110) return 1
		if (bp >= 111 &amp;&amp; bp &lt;= 219) return 0
		throw new NEWSError(`Unable to calculate NEWS: BP incorrect (${bp})`)
	}

	/**
	 * Create EWS for patient consciousness level
	 * @returns {number}
	 */
	scoreCons() {
		if (this.conscLevel === 'A') return 0
		return 3
	}

	/**
	 * Create EWS for patient on supplemental oxygen
	 * @returns {number}
	 */
	scoreSuppOxy() {
		if (this.suppOxygen === 'on') return 2
		return 0
	}
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Apr 26 2019 15:33:49 GMT+0100 (British Summer Time) using the <a href="https://github.com/contentful/contentful-sdk-jsdoc">contentful-sdk-jsdoc</a> theme.
</footer>

<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
