<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>client/spa/pages/create-ward.jsx - Documentation</title>

    <script src="scripts/hljs/highlight.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/hljs.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Contact.html">Contact</a><ul class='methods'><li data-type='method'><a href="Contact.html#insert">insert</a></li><li data-type='method'><a href="Contact.html#populate">populate</a></li></ul></li><li><a href="CreateWard.html">CreateWard</a><ul class='methods'><li data-type='method'><a href="CreateWard.html#.validateForms">validateForms</a></li><li data-type='method'><a href="CreateWard.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="CreateWard.html#makeWard">makeWard</a></li><li data-type='method'><a href="CreateWard.html#render">render</a></li></ul></li><li><a href="DiagnosticReport.html">DiagnosticReport</a><ul class='methods'><li data-type='method'><a href="DiagnosticReport.html#fhir">fhir</a></li><li data-type='method'><a href="DiagnosticReport.html#fhirLinked">fhirLinked</a></li></ul></li><li><a href="Encounter.html">Encounter</a><ul class='methods'><li data-type='method'><a href="Encounter.html#delete">delete</a></li><li data-type='method'><a href="Encounter.html#fhir">fhir</a></li><li data-type='method'><a href="Encounter.html#insert">insert</a></li><li data-type='method'><a href="Encounter.html#populate">populate</a></li><li data-type='method'><a href="Encounter.html#update">update</a></li></ul></li><li><a href="Location.html">Location</a><ul class='methods'><li data-type='method'><a href="Location.html#.lookup">lookup</a></li><li data-type='method'><a href="Location.html#getFhir">getFhir</a></li></ul></li><li><a href="Observation.html">Observation</a><ul class='methods'><li data-type='method'><a href="Observation.html#fhir">fhir</a></li></ul></li><li><a href="OperationOutcome.html">OperationOutcome</a><ul class='methods'><li data-type='method'><a href="OperationOutcome.html#makeResponse">makeResponse</a></li></ul></li><li><a href="Patient.html">Patient</a><ul class='methods'><li data-type='method'><a href="Patient.html#delete">delete</a></li><li data-type='method'><a href="Patient.html#fhir">fhir</a></li><li data-type='method'><a href="Patient.html#insert">insert</a></li><li data-type='method'><a href="Patient.html#populate">populate</a></li><li data-type='method'><a href="Patient.html#update">update</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#getJwtPayload">getJwtPayload</a></li><li><a href="global.html#Input">Input</a></li><li><a href="global.html#Loader">Loader</a></li><li><a href="global.html#Select">Select</a></li><li><a href="global.html#Welcome">Welcome</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">client/spa/pages/create-ward.jsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {h, Component} from 'preact'
import M from 'materialize-css'

import {fhirBase} from '../../util'

import '../styles/create-location.scss'

class CreateWard extends Component {
	/**
	 * Ensure elements have some content and change their class accordingly
	 * @param {Array&lt;VNode>} inputs Inputs to validate .value
	 * @return {boolean} Whether the given inputs are valid
	 */
	static validateForms(inputs) {
		// give empty fields a red box, remove valid classname too
		const invalid = inputs.filter((control) => {
			if (!control.value) {
				control.classList.add('invalid')
				control.classList.remove('valid')
			}
			return !control.value
		})

		// give all valid ones the green box, removing the red
		inputs.forEach((control) => {
			if (!invalid.includes(control)) {
				control.classList.remove('invalid')
				control.classList.add('valid')
			}
		})

		// length === 0 if all inputs have some data. cast this to boolean
		return !invalid.length
	}

	/**
	 * Page component used to create locations by interacting with /fhir/Location API
	 * @param {object} props Props given to the preact component
	 */
	constructor(props) {
		super(props)
		this.instances = []
		// used display a popup if there's a server-side error
		this.state = {
			showPopup: false,
			message: '',
		}
	}

	/**
	 * Initialise all materialize elements on page load
	 */
	componentDidMount() {
		this.instances.push(
			M.FormSelect.init(this.type),
			M.CharacterCounter.init(this.name),
			M.CharacterCounter.init(this.desc),
		)
	}

	componentDidUpdate() {
		this.instances.push(
			M.FormSelect.init(this.type),
			M.CharacterCounter.init(this.name),
			M.CharacterCounter.init(this.desc),
		)
	}


	/**
	 * Validate the elements on the page and then POST their data to /fhir/Location
	 * @param {Event} ev Click event
	 * @returns {Promise&lt;void>}
	 */
	async makeWard(ev) {
		ev.preventDefault() // don't refresh the page - this is a SPA!
		const inputs = [this.name, this.desc, this.type] // inputs to check
		const valid = CreateWard.validateForms(inputs)
		if (!valid) return // not valid. let the classNames do the talking

		// populate a form and send it to the server
		const locForm = new FormData()
		inputs.forEach(control => locForm.set(control.id, control.value))

		// attempt to post
		try {
			const resp = await fhirBase.post('/Location', locForm)
			const {id} = resp.data.issue[0].diagnostics
			const message = (
				&lt;div className="card-content">
					&lt;span className="card-title">Success&lt;/span>
					&lt;p>Successfully created {this.name.value} as a {this.type.value} with ID {id}&lt;/p>
				&lt;/div>
			)

			this.setState({
				message,
				showPopup: true,
			})
		} catch (err) {
			this.setState({
				showPopup: true,
				message: (
					&lt;div className="card-content">
						&lt;span className="card-title">Error!&lt;/span>
						&lt;p>There was an error creating the location:&lt;/p>
						&lt;p>{err}&lt;/p>
					&lt;/div>
				),
			})
		}
	}

	closePopup() {
		this.setState({message: '', showPopup: false})
	}

	/**
	 * render the form!
	 */
	render() {
		let popup = ''
		if (this.state.showPopup) {
			popup = (
				&lt;div className="col s12 m6">
					&lt;div className="card">
						&lt;span className="close" onClick={this.closePopup.bind(this)}>&lt;i className="material-icons">close&lt;/i>&lt;/span>
						{this.state.message}
					&lt;/div>
				&lt;/div>
			)
		}
		return (
			&lt;div className="row">
				{popup}
				&lt;div className="create-location-input col s12">
					&lt;header>&lt;h1>Create a Ward&lt;/h1>&lt;/header>
					&lt;form ref={f => this.form = f} className="row">
						&lt;div className="input-field col m6 s12">
							&lt;input id="name" type="text" ref={i => this.name = i} data-length="24" />
							&lt;label htmlFor="name" className="validate">Name&lt;/label>
						&lt;/div>

						&lt;div className="input-field col s12">
							&lt;textarea id="description" className="materialize-textarea" ref={t => this.desc = t} data-length="120" />
							&lt;label htmlFor="description" className="validate">Description&lt;/label>
						&lt;/div>

						&lt;div className="col s12 m6">
							&lt;label htmlFor="type">Type of location:&lt;/label>
							&lt;select id="type" ref={s => this.type = s} className="validate">
								&lt;option value="" disabled selected>--Please select an option---&lt;/option>
								&lt;option value="ward">Ward&lt;/option>
								&lt;option value="wing">Wing&lt;/option>
							&lt;/select>
						&lt;/div>

						&lt;div className="col s12">
							&lt;a className="waves-effect waves-light btn" onClick={this.makeWard.bind(this)}>Submit&lt;/a>

						&lt;/div>
					&lt;/form>
				&lt;/div>
			&lt;/div>
		)
	}
}

export default CreateWard
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Jan 30 2019 16:26:41 GMT+0000 (Greenwich Mean Time) using the <a href="https://github.com/contentful/contentful-sdk-jsdoc">contentful-sdk-jsdoc</a> theme.
</footer>

<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
