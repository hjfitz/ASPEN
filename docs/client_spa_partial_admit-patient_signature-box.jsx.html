<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>client/spa/partial/admit-patient/signature-box.jsx - Documentation</title>

    <script src="scripts/hljs/highlight.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/hljs.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AdmitPatient.html">AdmitPatient</a><ul class='methods'><li data-type='method'><a href="AdmitPatient.html#admit">admit</a></li><li data-type='method'><a href="AdmitPatient.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="AdmitPatient.html#getImg">getImg</a></li><li data-type='method'><a href="AdmitPatient.html#render">render</a></li><li data-type='method'><a href="AdmitPatient.html#setImg">setImg</a></li></ul></li><li><a href="App.html">App</a><ul class='methods'><li data-type='method'><a href="App.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="App.html#onChange">onChange</a></li><li data-type='method'><a href="App.html#render">render</a></li></ul></li><li><a href="global.html#Contact">Contact</a><ul class='methods'><li data-type='method'><a href="global.html#Contact#insert">insert</a></li><li data-type='method'><a href="global.html#Contact#populate">populate</a></li></ul></li><li><a href="CreateWard.html">CreateWard</a><ul class='methods'><li data-type='method'><a href="CreateWard.html#.validateForms">validateForms</a></li><li data-type='method'><a href="CreateWard.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="CreateWard.html#makeWard">makeWard</a></li><li data-type='method'><a href="CreateWard.html#render">render</a></li></ul></li><li><a href="DiagnosticReport.html">DiagnosticReport</a><ul class='methods'><li data-type='method'><a href="DiagnosticReport.html#fhir">fhir</a></li><li data-type='method'><a href="DiagnosticReport.html#fhirLinked">fhirLinked</a></li></ul></li><li><a href="Encounter.html">Encounter</a><ul class='methods'><li data-type='method'><a href="Encounter.html#delete">delete</a></li><li data-type='method'><a href="Encounter.html#fhir">fhir</a></li><li data-type='method'><a href="Encounter.html#insert">insert</a></li><li data-type='method'><a href="Encounter.html#populate">populate</a></li><li data-type='method'><a href="Encounter.html#update">update</a></li></ul></li><li><a href="Location.html">Location</a><ul class='methods'><li data-type='method'><a href="Location.html#.lookup">lookup</a></li><li data-type='method'><a href="Location.html#fhir">fhir</a></li><li data-type='method'><a href="Location.html#populate">populate</a></li></ul></li><li><a href="module.exports.html">exports</a></li><li><a href="NEWSError.html">NEWSError</a></li><li><a href="Observation.html">Observation</a><ul class='methods'><li data-type='method'><a href="Observation.html#fhir">fhir</a></li></ul></li><li><a href="OperationOutcome.html">OperationOutcome</a><ul class='methods'><li data-type='method'><a href="OperationOutcome.html#makeResponse">makeResponse</a></li></ul></li><li><a href="Patient.html">Patient</a><ul class='methods'><li data-type='method'><a href="Patient.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="Patient.html#delete">delete</a></li><li data-type='method'><a href="Patient.html#delete">delete</a></li><li data-type='method'><a href="Patient.html#fhir">fhir</a></li><li data-type='method'><a href="Patient.html#insert">insert</a></li><li data-type='method'><a href="Patient.html#populate">populate</a></li><li data-type='method'><a href="Patient.html#popupAE">popupAE</a></li><li data-type='method'><a href="Patient.html#popupHistory">popupHistory</a></li><li data-type='method'><a href="Patient.html#popupWarningScoreHistory">popupWarningScoreHistory</a></li><li data-type='method'><a href="Patient.html#render">render</a></li><li data-type='method'><a href="Patient.html#submitVitals">submitVitals</a></li><li data-type='method'><a href="Patient.html#update">update</a></li></ul></li><li><a href="Questionnaire.html">Questionnaire</a><ul class='methods'><li data-type='method'><a href="Questionnaire.html#toggleQuestionnaire">toggleQuestionnaire</a></li></ul></li><li><a href="Redirect.html">Redirect</a><ul class='methods'><li data-type='method'><a href="Redirect.html#componentWillMount">componentWillMount</a></li><li data-type='method'><a href="Redirect.html#render">render</a></li></ul></li><li><a href="SearchPatient.html">SearchPatient</a><ul class='methods'><li data-type='method'><a href="SearchPatient.html#componentWillUnmount">componentWillUnmount</a></li><li data-type='method'><a href="SearchPatient.html#render">render</a></li><li data-type='method'><a href="SearchPatient.html#renderPatients">renderPatients</a></li><li data-type='method'><a href="SearchPatient.html#search">search</a></li></ul></li><li><a href="Ward.html">Ward</a><ul class='methods'><li data-type='method'><a href="Ward.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="Ward.html#render">render</a></li><li data-type='method'><a href="Ward.html#renderPatients">renderPatients</a></li></ul></li><li><a href="WardList.html">WardList</a><ul class='methods'><li data-type='method'><a href="WardList.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="WardList.html#createWardList">createWardList</a></li><li data-type='method'><a href="WardList.html#render">render</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#AlcoholQuestionnaire">AlcoholQuestionnaire</a></li><li><a href="global.html#Breadcrumbs">Breadcrumbs</a></li><li><a href="global.html#calculate">calculate</a></li><li><a href="global.html#checkPass">checkPass</a></li><li><a href="global.html#createOutcome">createOutcome</a></li><li><a href="global.html#DecButton">DecButton</a></li><li><a href="global.html#decodeJWTPayload">decodeJWTPayload</a></li><li><a href="global.html#Diet">Diet</a></li><li><a href="global.html#dispatchMouseUp">dispatchMouseUp</a></li><li><a href="global.html#doModal">doModal</a></li><li><a href="global.html#DrugTable">DrugTable</a></li><li><a href="global.html#emulateTouch">emulateTouch</a></li><li><a href="global.html#Exercise">Exercise</a></li><li><a href="global.html#fhirBase">fhirBase</a></li><li><a href="global.html#formatDate">formatDate</a></li><li><a href="global.html#getCurrentUrl">getCurrentUrl</a></li><li><a href="global.html#getDate">getDate</a></li><li><a href="global.html#getGiven">getGiven</a></li><li><a href="global.html#getJwtPayload">getJwtPayload</a></li><li><a href="global.html#getPatientReport">getPatientReport</a></li><li><a href="global.html#getStyle">getStyle</a></li><li><a href="global.html#handleUser">handleUser</a></li><li><a href="global.html#HistoryReport">HistoryReport</a></li><li><a href="global.html#IncButton">IncButton</a></li><li><a href="global.html#Input">Input</a></li><li><a href="global.html#lengthPolicy">lengthPolicy</a></li><li><a href="global.html#Loader">Loader</a></li><li><a href="global.html#Modal">Modal</a></li><li><a href="global.html#noop">noop</a></li><li><a href="global.html#normalisePatientInfo">normalisePatientInfo</a></li><li><a href="global.html#normalisePatientReports">normalisePatientReports</a></li><li><a href="global.html#OtherQuestions">OtherQuestions</a></li><li><a href="global.html#PatientDemographicInfo">PatientDemographicInfo</a></li><li><a href="global.html#score">score</a></li><li><a href="global.html#scoreBP">scoreBP</a></li><li><a href="global.html#scoreCons">scoreCons</a></li><li><a href="global.html#scoreHeart">scoreHeart</a></li><li><a href="global.html#scoreOxy">scoreOxy</a></li><li><a href="global.html#scoreResp">scoreResp</a></li><li><a href="global.html#scoreSuppOxy">scoreSuppOxy</a></li><li><a href="global.html#scoreTemp">scoreTemp</a></li><li><a href="global.html#Select">Select</a></li><li><a href="global.html#showLogin">showLogin</a></li><li><a href="global.html#SignOff">SignOff</a></li><li><a href="global.html#toTitle">toTitle</a></li><li><a href="global.html#Welcome">Welcome</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">client/spa/partial/admit-patient/signature-box.jsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {h, Component} from 'preact'

/**
 * given a container, return a function that checks returns a function to get a property value
 * @param {HTMLElemement} container Containter to get a style and parse int to
 */
const getStyle = container => prop => parseInt(getComputedStyle(container, null)
	.getPropertyValue(prop)
	.replace('px', ''), 10)

/**
 * Given a touch event, get the X and Y, and simulate a mousemove event
 * Simulate button 1: this is the click button
 * @param {Event} e event to simulate as a mouseclick
 */
function emulateTouch(e) {
	e.preventDefault()
	const touch = e.touches[0]
	const mouseEvent = new MouseEvent('mousemove', {
		clientX: touch.clientX,
		clientY: touch.clientY,
		buttons: 1,
	})
	document.dispatchEvent(mouseEvent)
}

/**
 * simulate mouseup on touchstop
 * @returns {Boolean}
 */
function dispatchMouseUp() {
	return document.dispatchEvent(new MouseEvent('mouseup', {}))
}


class Signature extends Component {
	constructor() {
		super()
		this.pos = {x: 0, y: 0}
		this.draw = this.draw.bind(this)
		this.setPosition = this.setPosition.bind(this)
		this.setTouchPosition = this.setTouchPosition.bind(this)
	}

	/**
	 * on mount, add event listeners for mousemove
	 * add event listeners for touch events that simulate mousemove events
	 */
	componentDidMount() {
		// set up event listeners
		document.addEventListener('mousemove', this.draw)
		document.addEventListener('mousedown', this.setPosition)
		document.addEventListener('mouseEnter', this.setPosition)

		/**
		 * spoof mouse events using touch events to
		 * so that a phone user can make a signature
		 */
		this.canvas.addEventListener('touchstart', this.setTouchPosition)
		this.canvas.addEventListener('touchend', dispatchMouseUp)
		this.canvas.addEventListener('touchmove', emulateTouch)
	}

	/**
	 * on unmount, remove all event listeners
	 */
	componentWillUnmount() {
		document.removeEventListener('mousemove', this.draw)
		document.removeEventListener('mousedown', this.setPosition)
		document.removeEventListener('mouseEnter', this.setPosition)

		/**
		 * spoof mouse events using touch events to
		 * so that a phone user can make a signature
		 */
		this.canvas.removeEventListener('touchstart', this.setTouchPosition)
		this.canvas.removeEventListener('touchend', dispatchMouseUp)
		this.canvas.removeEventListener('touchmove', emulateTouch)
	}

	setTouchPosition(ev) {
		return this.setPosition(ev.touches[0])
	}

	/**
	 * Given an event, take the mouse coords and update the mouse position in this component
	 * @param {Event} ev
	 */
	setPosition(ev) {
		// no need to set state as component doesn't need to render again
		this.pos = {
			x: ev.clientX - this.canvas.getBoundingClientRect().left,
			y: ev.clientY - this.canvas.getBoundingClientRect().top,
		}
	}

	/**
	 * resize the canvas to fill available space on every draw()
	 */
	setCanvasDimensions() {
		if (!this.setWidth) {
			const getProp = getStyle(this.content)
			const padLeft = getProp('padding-left')
			const padRight = getProp('padding-right')
			const horzPad = padLeft + padRight

			const {width} = this.content.getBoundingClientRect()
			const {height} = this.canvas.getBoundingClientRect()
			this.canvas.height = height
			this.canvas.width = (width - horzPad)
			this.setWidth = true
		}
	}

	/**
	 * on a mousemove event, move a virtual pointer on a canvas
	 * update this position with the event
	 * move the virtual pointer to the new place
	 * stroke a line between the beginning and end
	 * @param {Event} ev mousemove event
	 */
	draw(ev) {
		const {ctx} = this
		// mouse left button must be pressed

		if (ev.buttons !== 1) return
		this.setCanvasDimensions()

		ctx.beginPath() // begin

		ctx.lineWidth = 5
		ctx.lineCap = 'round'
		ctx.strokeStyle = '#000'

		ctx.moveTo(this.pos.x, this.pos.y) // from
		this.setPosition(ev)
		ctx.lineTo(this.pos.x, this.pos.y) // to

		ctx.stroke() // draw it!
	}

	/**
	 * clear the signature on the canvas
	 * @param {Event} ev Click event
	 */
	reset(ev) {
		ev.preventDefault()
		this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)
	}

	/**
	 * @returns {preact.VNode}
	 */
	render() {
		return (
			&lt;div className="card z-depth-0">
				&lt;div className="card-content" ref={c => this.content = c}>
					&lt;span className="card-title">Sign below&lt;/span>
					&lt;canvas
						ref={(c) => {
							try {
								this.canvas = c
								this.ctx = c.getContext('2d')
							} catch (e) {}
						}}
						id="sign-off-canvas"
						style={{width: '100%', border: '1px solid grey'}}
					/>
				&lt;/div>
				&lt;div className="card-action">
					&lt;a href="" className="teal-text text-lighten-1" onClick={this.reset.bind(this)}>Reset&lt;/a>
				&lt;/div>
			&lt;/div>
		)
	}
}

export default Signature
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Apr 26 2019 15:33:49 GMT+0100 (British Summer Time) using the <a href="https://github.com/contentful/contentful-sdk-jsdoc">contentful-sdk-jsdoc</a> theme.
</footer>

<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
